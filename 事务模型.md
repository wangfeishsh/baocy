Java 中有三种可以 的事务模型,分别称作本地事务模型\(Local Transaction Model\),编程式事务模型 \(Programmatic Transaction Model\),和声明式事务模型\(Declarative Transaction Model\)。虽 然,在随后的章节将分别深入讲解,我想在这里还是有必要将它们分别概述一下。

所谓“本地事务模型”,得名于事实上不是编程框架本身来管理事务,事务是交给本地资源管 理器\(local resource manager\)来管理的。资源管理器是用于通信的、事实上的数据源\(data source\)提供者。举例来说,对于数据库,资源管理器是通过数据库驱动和数据库管理系统 \(Database Management System,DBMS\)来实现的。对于 JMS,所谓资源管理器就是通过特 定的 JMS 提供者\(provider\)实现的队列\(queue\)或主题\(topic\)的连接工厂\(connection factory\)。经由本地事务模型,开发人员管理的是“连接\(connection\)”,而非 “事务”。DBMS 和 JMS 的提供者真正管理了本地事务。关于“本地事务模型”的细节将在第二章介绍。

“编程式事务模型”利用了 Java 事务 API\(Java Transaction API, JTA\)及其底层事务服务实现的 能量以提供事务支持,突破了“本地事务模型”的种种限制。通过编程式事务模型,开发人员 的编码对象是“事务”,而非“连接”。通过使用 javax.transaction.UserTransation 接口,开发人 员调用 begin\(\)方法开始一个事务,调用 commit\(\)或 rollback\(\)方法去终止这个事务。虽然通 常情况下不鼓励大量使用编程式事务,然而,在客户端发起的,对远程无状态会话 Bean \(Stateless Session Beans\)的 EJB 事务访问的场景下,它还是有可能用到的。我们将在第三 章仔细讨论这种事务模型。

“声明式事务模型”,在 EJB 的世界中也成为容器托管的事务模型\(Container-Managed Transactions\),是本书通篇所主要聚焦的事务模型。在声明式事务模型的环境下,软件框架 或“容器”管理了事务的开始和结束\(或者提交,或者回滚\)。开发人员仅仅需要告诉软件框 架,碰到应用异常时“去回滚事务”即可,对事务的配置都是通过 EJB 中的 XML 部署描述文件 \(例如 ejb-jar.xml\)或 Spring 中的 bean 定义文件\(例如 ApplicationContext.xml\)来完成的。

参考1：

大体上所来，JTA是一种接口规范，定义了一套接口，接口定义了相关的程序角色之间需要遵守的约定，JTA中约定了几种主要的程序角色，分别是事务管理器、事务客户、应用服务器、资源管理器。简单地说来就是，事务客户发起事务，应用服务器根据事物客户的请求决定如何向事务管理器体提交一个事务请求，如新建一个（require new），参与（require）等，事务管理器接收到了应用服务器发出的事务请求，然后事务管理器根据某种特定的协议（一般是两阶段提交协议）和资源管理器通过交换事务上下文来实现事务的功能。在这里，事务客户使用UserTransaction接口，应用服务器使用TransactionManager、Transaction、Synchronization接口，资源管理器实现XAResource接口。

那么JTS呢？JTA和JTS的关系如何呢？上面的内容有提到事务管理器要和资源管理器要进行事务上下文传播的交互，其中应用服务器和事务管理器之间也有传播事务上下文的交互，有时候事务客户和应用服务器也需要传播事务上下文，众所周知，只要涉及到软件交互往往都会有一套规范。那么如何来传递这种事务上下文呢？这就是JTS了。JTS也定义了一套规范，它约定了各个程序角色之间如何传递事务上下文，它源自CORBA 的OTS规范，基于IIOP（一种软件交互协议）。不要认为JTS是JTA的实现，JTA其实就定义了一个空架子，告诉JTA的实现者应该怎样做怎样做，但是具体到做的时候JTS就来插一手了。因为JTA约定的这些角色要进行事务上下文的交互啊，JTS约定了应该怎样去进行交互。

总体上来说JTA更多的是从框架的角度来约定程序角色的接口，而JTS则是从具体实现的角度来约定程序角色之间的接口，两者各司其职。照这样看来，SUN搞出来的这两个名字还真有点艺术感，有点哲学的味道了。

参考2:

**JTA**

JTA定义了一套接口，其中约定了几种主要的角色：TransactionManager、UserTransaction、Transaction、XAResource，并定义了这些角色之间需要遵守的规范，如Transaction的委托给TransactionManager等。

** JTS**

JTS也是一组规范，上面提到JTA中需要角色之间的交互，那应该如何交互？JTS就是约定了交互细节的规范。

总体上来说JTA更多的是从框架的角度来约定程序角色的接口，而JTS则是从具体实现的角度来约定程序角色之间的接口，两者各司其职。

因为JTA相对来说，更高层一些，我们主要关注JTA。

** XA**

XA协议，规定事务管理器和资源管理器接口，采用二阶段提交协议。

** 源码**

规范的接口位于javax.transaction：

![](/assets/6.png)

